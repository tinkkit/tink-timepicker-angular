/*! tink-timepicker-angular v2.0.1 */
"use strict";!function(module){try{module=angular.module("tink.timepicker")}catch(e){module=angular.module("tink.timepicker",["tink.safeApply"])}module.directive("tinkTimepicker",["$window","safeApply","$timeout",function($window,safeApply,$timeout){return{restrict:"AE",template:'<div class="timepicker"><input type="text" ng-model="ngModel"/><span class="timepicker-later" role="spinbutton"></span><span class="timepicker-earlier" role="spinbutton"></span><button class="upload-btn-delete" data-ng-if="ngModel && allowClear" data-ng-click="setNull()"><span class="sr-only">Leegmaken</span></button></div>',require:"ngModel",replace:!1,scope:{ngModel:"=",minDate:"=?",allowClear:"=?"},link:function(scope,elem,attr,ngModel){function isDateSupported(){var i=document.createElement("input");return i.setAttribute("type","date"),"text"!==i.type}var current={hour:{num:0,reset:!0,prev:-1,start:!0},min:{num:0,reset:!0,start:!0}},inputField=elem.find("input"),clearBtn=elem.find(".upload-btn-delete");attr.$observe("disabled",function(val){val||""===val||"string"==typeof val&&"disabled"===val.toLowerCase()?(inputField.attr("disabled","disabled"),clearBtn.addClass("hidden")):(inputField.removeAttr("disabled"),clearBtn.removeClass("hidden"))});var isNative=/(ip(a|o)d|iphone|android)/gi.test($window.navigator.userAgent);isNative&&isDateSupported()&&inputField.prop("type","time"),elem.find(".timepicker-later").bind("mousedown",function(){return!1}),elem.find(".timepicker-later").bind("click",function(){return 1===selected?addHour(1):2===selected&&addMinute(1),!1});var bindEvent=function(){inputField.unbind("input").unbind("keydown").unbind("change").unbind("click").unbind("mousedown"),inputField.keydown(function(e){safeApply(scope,function(){ngModel.$setDirty()});var keycode=e.which;return keycode>47&&58>keycode||keycode>95&&106>keycode?2===selected?handleMinute(keycode):handleHour(keycode):39===keycode&&1===selected?selectMinute(!0):37===keycode&&2===selected?selectHour(!0):38===keycode?1===selected?addHour(1):2===selected&&addMinute(1):40===keycode&&(1===selected?addHour(-1):2===selected&&addMinute(-1)),9!==keycode?!1:void 0})};elem.find(".timepicker-earlier").bind("mousedown",function(){return!1}),elem.find(".timepicker-earlier").bind("click",function(){return 1===selected?addHour(-1):2===selected&&addMinute(-1),!1}),isNative&&isDateSupported()?inputField.val("00:00:00"):bindEvent();var keycodeMapper={},mapKeycodes=function(){for(var hulp=0,i=48;57>=i;i++)keycodeMapper[i]=hulp,hulp++;hulp=0;for(var j=96;105>=j;j++)keycodeMapper[j]=hulp,hulp++};mapKeycodes();var handleHour=function(key){var num=keycodeMapper[key];current.hour.reset&&(current.hour.num=0,current.hour.prev=-1,current.hour.reset=!current.hour.reset),current.hour.start=!1,scope.setHour(num)},selectHour=function(reset){isNative&&isDateSupported()||inputField[0].setSelectionRange(0,2),selected=1,current.hour.reset=reset,current.min.reset=!1},selectMinute=function(reset){isNative&&isDateSupported()||inputField[0].setSelectionRange(3,5),selected=2,current.min.reset=reset,current.hour.reset=!1};scope.setHour=function(num){var select=2,firstNumber=parseInt(hourString()[0]),lastNumber=parseInt(hourString()[1]);2>lastNumber?(current.hour.num=10*lastNumber+num,select=-1!==current.hour.prev?2:0!==firstNumber?2:1):2===lastNumber?(4>num?current.hour.num=10*lastNumber+num:current.hour.num=num,select=2):(current.hour.num=num,select=2),current.hour.prev=num,setValue(select)};var hourString=function(){return current.hour.start?"--":("0"+current.hour.num).slice(-2)},minString=function(){return current.min.start?"--":("0"+current.min.num).slice(-2)};scope.setMinute=function(num){var lastNumber=parseInt(minString()[1]);isNaN(lastNumber)||0===lastNumber||lastNumber>5?current.min.num=num:6>lastNumber&&(current.min.num=10*lastNumber+num),setValue(2)},scope.setNull=function(){attr.disabled||""===attr.disabled||"[object Date]"===Object.prototype.toString.call(scope.ngModel)&&scope.ngModel.setHours(0,0,0,0)};var setValue=function(select){if(isNative&&isDateSupported()){var timeStr=hourString()+":"+minString()+":00";timeStr.replace("-","0"),inputField.val(timeStr)}else inputField.val(hourString()+":"+minString());if(ngModel.$render(),1===select?selectHour():2===select&&selectMinute(),scope.minDate&&scope.minDate.getFullYear&&scope.minDate.getMonth&&scope.minDate.getDate){var inputDate=new Date(scope.minDate.getFullYear(),scope.minDate.getMonth(),scope.minDate.getDate(),current.hour.num,current.min.num);inputDate<scope.minDate?ngModel.$setValidity("min",!1):ngModel.$setValidity("min",!0)}},handleMinute=function(key){var num=keycodeMapper[key];current.min.start=!1,scope.setMinute(num)},selected=-1,getHourOffset=function(){var padding=parseInt(inputField.css("padding-left"),10);return padding+inputField.val().substr(0,2).width(inputField.css("font"),inputField.css("padding"))+2},getMinOffset=function(){return getHourOffset()+inputField.val().substr(3,2).width(inputField.css("font"),inputField.css("padding"))+2},pollyOffset=function(e){var target=e.target||e.srcElement,style=target.currentStyle||window.getComputedStyle(target,null),borderLeftWidth=parseInt(style.borderLeftWidth,10),rect=target.getBoundingClientRect(),offsetX=e.clientX-borderLeftWidth-rect.left;return offsetX};inputField.bind("mousedown",function(evt){var offset=pollyOffset(evt);return offset<getHourOffset()||offset>getMinOffset()?(selectHour(!0),selected=1):(selectMinute(!0),selected=2),inputField.focus(),!1}),String.prototype.width=function(font,padding){var f=font||"15px arial",p=padding||"",o=$("<div>"+this+"</div>").css({position:"absolute","float":"left","white-space":"nowrap",visibility:"hidden",font:f,padding:p}).appendTo($("body")),w=o.width();return o.remove(),w};var addMinute=function(size){current.min.start=!1;var newMin=current.min.num+size;newMin>0&&60>newMin?current.min.num=newMin:newMin>=60||0>newMin?(addHour(Math.floor(newMin/60)),0>newMin%60?current.min.num=60+newMin%60:current.min.num=newMin%60):current.min.num=0,setValue(2)},addHour=function(size){current.hour.start=!1;var newHour=current.hour.num+size;newHour>0&&24>newHour?current.hour.num=newHour:0>newHour?current.hour.num=24+newHour:current.hour.num=0,setValue(1),current.hour.reset=!0},reset=function(){current={hour:{num:0,reset:!0,prev:-1,start:!0},min:{num:0,reset:!0,start:!0}},ngModel.$setValidity("time",!1),setValue()};scope.$watch("ngModel",function(newVal){var date=null,hour=null,minute=null;date="function"==typeof newVal?newVal():newVal,void 0===date||null===date?(current.hour.start=!0,current.min.start=!0,setValue()):angular.isDate(date)&&"Invalid Date"!==date?(hour=date.getHours(),minute=date.getMinutes()):angular.isDate(new Date(date))&&"Invalid Date"!==new Date(date)?(hour=new Date(date).getHours(),minute=new Date(date).getMinutes()):"Invalid Date"!==date&&"string"==typeof date&&date.length>=5&&/^([01]\d|2[0-3]):?([0-5]\d)$/.test(date.substr(0,5))?(hour=parseInt(date.substr(0,2)),minute=parseInt(date.substr(3,2))):reset(),null!==hour&&null!==minute&&angular.isDefined(hour)&&angular.isDefined(minute)&&(current.hour.start=!1,current.hour.num=hour,current.min.start=!1,current.min.num=minute,setValue())},!0),$(inputField).controller("ngModel").$formatters.push(function(value){var hour,min,time;return angular.isDate(value)?(hour=("0"+value.getHours()).slice(-2),min=("0"+value.getMinutes()).slice(-2),time=hour+":"+min):time=value,time}),$(inputField).controller("ngModel").$parsers.push(function(value){var dObject,hour=parseInt(value.substr(0,2)),minute=parseInt(value.substr(3,2));return dObject=angular.isDate(scope.ngModel)?scope.ngModel:new Date,dObject.setHours(hour),dObject.setMinutes(minute),dObject}),$(elem).on("focus",function(){safeApply(scope,function(){$timeout(function(){selectHour(),inputField.focus()},5)})}),inputField.on("blur",function(){safeApply(scope,function(){var time=inputField.val(),hour=parseInt(time.substr(0,2)),minute=parseInt(time.substr(3,2));if(null!==hour&&null!==minute&&angular.isDefined(hour)&&angular.isDefined(minute)&&!isNaN(hour)&&!isNaN(minute)){var returnObj;returnObj=angular.isDate(scope.ngModel)?new Date(scope.ngModel):new Date,returnObj.setHours(parseInt(hourString())),returnObj.setMinutes(parseInt(minString())),isNative&&isDateSupported()&&(returnObj.setHours(hour),returnObj.setMinutes(minute)),ngModel.$setViewValue(returnObj)}selected=-1,current.hour.reset=!0,current.min.reset=!0})})}}}])}();
//# sourceMappingURL=tink-timepicker-angular.min.map